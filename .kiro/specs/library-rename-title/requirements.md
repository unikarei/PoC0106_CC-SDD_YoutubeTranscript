# 要件定義: Library タイトルリネーム機能

## 背景

現状、文字起こし結果のタイトルは YouTube 動画のオリジナルタイトル（`audio_file.title`）または投入時に指定した `user_title` のいずれかが表示される。
しかし、YouTube タイトルは長すぎたり、投入後に管理しやすい名前に変更したいケースがある。

本機能では、Library タブから任意のジョブのタイトルを後から変更（リネーム）できるようにする。

## 目的

- Library に保存された文字起こし結果のタイトルを、UI から簡単にリネームできる
- 検索や整理のために、ユーザーが管理しやすい名称を設定できる

## スコープ

### In Scope（対象）

1. Library タブのアイテム一覧からタイトルをリネームできる
2. Results タブのメタ情報表示からタイトルをリネームできる
3. バックエンド API でタイトル更新をサポートする

### Out of Scope（対象外）

- タイトルの一括リネーム（将来機能）
- タイトル履歴の保存
- タイトルのバリデーション（空白禁止など）は最小限

## 機能要件

### FR-1: Library タブでのタイトルリネーム

#### FR-1.1 リネーム起動方法
- アイテム一覧の各行に「リネーム」アイコン/ボタンを表示する
- または、タイトル部分をクリックしてインライン編集モードに入る
- または、コンテキストメニュー（右クリック/...ボタン）から「リネーム」を選択する

#### FR-1.2 リネーム UI
- インライン編集: タイトル部分がテキスト入力欄に変わり、直接編集できる
- または、モーダルダイアログで新しいタイトルを入力する
- 確定: Enter キーまたは「保存」ボタン
- キャンセル: Escape キーまたは「キャンセル」ボタン

#### FR-1.3 リネーム後の反映
- 保存成功後、一覧のタイトルが即座に更新される
- エラー時は元のタイトルに戻り、エラーメッセージを表示する

### FR-2: Results タブでのタイトルリネーム

#### FR-2.1 リネーム起動方法
- メタ情報エリアのタイトル横に「編集」アイコンを表示する
- クリックでインライン編集モードに入る

#### FR-2.2 リネーム後の反映
- 保存成功後、タイトル表示が即座に更新される
- Library タブに戻った際も更新後のタイトルが表示される

### FR-3: バックエンド API

#### FR-3.1 タイトル更新 API
- エンドポイント: `PATCH /api/jobs/{job_id}/title`
- リクエストボディ:
  ```json
  {
    "title": "新しいタイトル"
  }
  ```
- レスポンス:
  ```json
  {
    "job_id": "xxx",
    "title": "新しいタイトル",
    "message": "Title updated successfully"
  }
  ```

#### FR-3.2 エラーハンドリング
- `404 Not Found`: ジョブが存在しない
- `400 Bad Request`: タイトルが不正（空文字、長すぎるなど）
- `500 Internal Server Error`: DB 更新失敗

#### FR-3.3 データベース更新
- `jobs.user_title` カラムを更新する
- `user_title` が設定されている場合、それが優先表示される（既存動作を維持）

## 非機能要件

### NFR-1: パフォーマンス
- タイトル更新は 1 秒以内に完了する

### NFR-2: ユーザビリティ
- リネーム操作は直感的で、2 クリック以内で開始できる
- インライン編集時、フォーカスが自動的にテキスト入力欄に移る
- テキストは全選択状態で編集を開始できる

### NFR-3: データ整合性
- タイトル更新は `user_title` カラムのみを変更し、他のフィールドに影響しない
- Library（Item テーブル）と Jobs テーブルの整合性を維持する

## ユースケース

### UC-1: Library からタイトルをリネーム

1. ユーザーが Library タブを開く
2. アイテム一覧から対象のアイテムを見つける
3. タイトル横のリネームアイコンをクリック
4. テキスト入力欄が表示され、現在のタイトルが入力済み状態になる
5. 新しいタイトルを入力して Enter を押す
6. 一覧のタイトルが更新される

### UC-2: Results からタイトルをリネーム

1. ユーザーが Results タブで文字起こし結果を閲覧している
2. メタ情報エリアのタイトル横の編集アイコンをクリック
3. タイトルが編集可能になる
4. 新しいタイトルを入力して保存
5. タイトル表示が更新される

## 受け入れ基準

- [ ] Library タブでタイトルをリネームできる
- [ ] Results タブでタイトルをリネームできる
- [ ] API `PATCH /api/jobs/{job_id}/title` が正常に動作する
- [ ] エラー時に適切なメッセージが表示される
- [ ] リネーム後、画面をリロードしても変更が反映されている
