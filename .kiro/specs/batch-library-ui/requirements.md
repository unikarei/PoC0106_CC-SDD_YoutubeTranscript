# 要件定義: Batch / Results / Library / Settings UI

## 背景
現状のUIは「1 URL → 1ジョブ」を前提にしており、過去ジョブ（文字起こし/校正/Q&A）の参照は job_id を知っている場合に限られる。
本機能では、複数URLの一括投入と、DBに保存された結果の参照（検索/フィルタ）を、シンプルで構造的に美しいUIとして提供する。

## 目的
- 複数のYouTube URLをまとめて投入し、非同期ジョブとして一括でキュー投入できる
- 文字起こし/校正/Q&A結果がDBに保存され、UIから検索・参照できる
- 「Batchは投入と進捗」「Resultsは1件を深掘り」「Libraryは探す」を明確に分離する

## スコープ
### UI（上部Tabs）
- Tab1: Batch（複数URL投入→一括実行）
- Tab2: Results（結果閲覧：Transcript / Proofread / QA）
- Tab3: Library（DB検索・フィルタ・再利用）
- Tab4: Settings（モデル/言語/分割/保存ポリシー）

## 機能要件

### 1. Batch タブ（複数URL投入→一括実行）

#### 1.1 レイアウト
- 2カラム構成
  - 左カラム: 入力（投入）
  - 右カラム: Queue（実行状況）
- 重要: Batchタブの結果表示は「プレビューのみ」。詳細はResultsタブへ。

#### 1.2 入力方式（トグル切替）
入力方式はラジオボタン等でA/B/Cを切り替える。

- A) URLリスト貼り付け（複数行）
  - 1行=1URLとして解釈
  - 空行は無視
- B) CSV貼り付け（url,title,tag…）
  - 1行=1レコード
  - 必須: url
  - 任意: title, tag（複数tagは `;` 区切り）
  - UIの入力欄に「tagは `;` 区切り」と注記する
- C) プレイリスト/チャンネルURL
  - URLを入力し「展開」して動画一覧へ変換して投入対象にできる

#### 1.3 共通設定（Batch投入時）
以下をBatch投入の共通設定として指定できる。
- 言語
- 文字起こしモデル
- 分割方針（例: `MAX_SINGLE_CHUNK_SEC` の値を指定）
- Proofread 有無
- QA 有無

#### 1.4 実行
- Run ボタンで投入対象をQueueへ投入する
- 投入後は、Queueテーブルに行が追加され進捗が追跡できる

#### 1.5 Queue（実行状況）
- テーブル列:
  - 状態（job status）
  - タイトル
  - 長さ
  - 進捗
  - エラー
  - 再試行
- 行クリック:
  - 右カラム下段に「この動画の最新結果プレビュー」を表示する
  - プレビューは簡易（先頭数百〜数千文字 + QAの最新1件など）


### 2. Results タブ（1件を深く見る）

#### 2.1 対象の選択
- Resultsは「選択された1ジョブ」を表示する
- Tab3（Library）からの遷移で対象jobを切り替えられる
- 最小要件として、URLパラメータ（例: `?job_id=`）等で直接開ける

#### 2.2 メタ情報（上段）
- タイトル
- URL
- 長さ
- 作成日時
- タグ

#### 2.3 サブタブ（中段）
- Transcript（原文）
- Proofread（校正後）
- QA（質問履歴＋回答）

#### 2.4 右上アクション
- Save to DB
  - 自動保存ポリシーがONのときはボタンを出さず “Saved” バッジ表示のみ
- Export（txt/json）
- Re-run（モデル変更して再実行）


### 3. Library タブ（DB検索・フィルタ・再利用）

#### 3.1 レイアウト
- 2カラム構成
  - 左: 検索フィルタ
  - 右: 検索結果（カード or テーブル）

#### 3.2 検索フィルタ
最低限、以下を提供する（未実装の概念は除外する）。
- キーワード（タイトル/URL/文字起こし本文のいずれかに対して）
- タグ
- 期間
- 言語
- モデル
- 長さ
- QAあり

#### 3.3 検索結果
- クリックで Results タブを対象jobで開く

#### 3.4 削除（単体/一括）
- Libraryの検索結果でジョブを削除できる
  - 単体削除: 行ごとに「削除」ボタン
  - 一括削除: チェックボックスで複数選択し「選択を削除 (N)」
- 安全性のため、処理中ジョブ（in progress）は削除できない（UIはエラー表示）
- 削除時は確認（confirm）を1回挟む（最小実装）
- 削除が成功した場合、削除対象は直ちに結果一覧（GUI）から消え、選択状態も解除される

#### 3.4 Saved Searches（任意）
- 「Saved Searches（検索条件保存）」は追加可能
- ただし、これ以外の拡張（お気に入り、分析など）は本機能のスコープ外


### 4. Settings タブ（モデル/言語/分割/保存ポリシー）
- デフォルト値（モデル/言語/分割/Proofread/QA）を設定し、Batch/Resultsで参照される
- 保存ポリシー:
  - 自動保存（DB永続化）を前提としつつ、UI上は「Saved」表示の挙動を制御できる
  - UI設定はブラウザローカルに保持（例: LocalStorage）


## 非機能要件
- 既存のデザインシステム/コンポーネント/Tailwindトークンを尊重し、新しい色・フォント・影をハードコードしない
- 既存APIが返すステータス/進捗表示と整合する
- バッチ投入は大量投入でもUIが破綻しない（最低限: 逐次投入 + 進捗ポーリングの負荷制御）


## 非ゴール
- ユーザー認証/マルチテナント
- 分析ダッシュボード、全文検索エンジン導入
- 要約機能（要約ありフィルタ等は将来）
- Playlist/Channelの全ての形式への完全対応（最小実装で対応する）


## 受け入れ基準（Acceptance Criteria）
- BatchタブでA/B/Cいずれかの方式で複数URLを投入でき、Queueに進捗が表示される
- Batchタブの結果表示はプレビューのみで、詳細はResultsで確認できる
- ResultsタブでTranscript/Proofread/QAのサブタブを切替表示できる
- LibraryタブでDB上の過去ジョブを検索し、クリックでResultsに遷移できる
- Libraryタブで単体削除/一括削除ができ、削除後は一覧から消える
- Settingsタブでデフォルト設定が変更でき、Batch/Resultsに反映される

補足（UX改善）:
- Proofread/QA は非同期処理のため、完了後にタブ切替しなくても結果が表示される（ポーリング等で反映）
- QAの質問入力欄は十分な幅で表示される（モデルselect等に押し潰されない）

補足（今回の合意）:
- Libraryのキーワード検索は初期実装では title/url を対象にしてよい（Transcript全文検索は段階導入）
