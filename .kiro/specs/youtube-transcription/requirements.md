# Requirements Document

## Project Description (Input)
YouTubeの音声をダウンロードして日英文字起こしするWebアプリ

## Introduction
本仕様は、YouTube動画の音声を抽出し、日本語および英語の文字起こしを提供するWebアプリケーションの要件を定義する。ユーザーはYouTube URLを入力するだけで、動画の音声内容をテキストとして取得できる。

## Requirements

### Requirement 1: YouTube動画入力
**Objective:** ユーザーとして、YouTube動画のURLを入力できるようにしたい。そうすることで、文字起こししたい動画を指定できる。

#### Acceptance Criteria
1. When ユーザーがYouTube URLを入力フィールドに貼り付けた場合、the システムは URLの形式を検証すること
2. If 入力されたURLがYouTubeの有効な形式でない場合、then the システムは エラーメッセージを表示すること
3. The システムは 標準的なYouTube URL形式（https://www.youtube.com/watch?v=、https://youtu.be/）をサポートすること
4. When 有効なYouTube URLが入力された場合、the システムは 動画の基本情報（タイトル、長さ）を表示すること

### Requirement 2: 音声ダウンロード
**Objective:** ユーザーとして、指定したYouTube動画の音声を取得できるようにしたい。そうすることで、文字起こし処理の準備ができる。

#### Acceptance Criteria
1. When ユーザーがダウンロードボタンをクリックした場合、the システムは YouTube動画から音声トラックを抽出すること
2. While 音声ダウンロード中の場合、the システムは 進行状況インジケーターを表示すること
3. If 音声ダウンロードに失敗した場合、then the システムは 具体的なエラー内容（例: 動画が利用不可、著作権制限）を表示すること
4. The システムは 一般的な音声形式（MP3、M4A、WAV等）で音声を抽出すること
5. When 音声ダウンロードが完了した場合、the システムは ユーザーに完了通知を表示すること

### Requirement 3: 日本語文字起こし
**Objective:** ユーザーとして、ダウンロードした音声から日本語の文字起こしを取得できるようにしたい。そうすることで、日本語コンテンツの内容を理解できる。

#### Acceptance Criteria
1. When ユーザーが日本語文字起こしを選択した場合、the システムは 音声を日本語テキストに変換すること
2. While 文字起こし処理中の場合、the システムは 進行状況と推定残り時間を表示すること
3. The システムは 話者の区別、句読点、段落分けを適切に行うこと
4. When 文字起こしが完了した場合、the システムは テキスト結果を画面に表示し、LLM校正オプションを提供すること
5. If 音声が日本語でない場合、then the システムは 言語不一致の警告を表示すること

### Requirement 4: 英語文字起こし
**Objective:** ユーザーとして、ダウンロードした音声から英語の文字起こしを取得できるようにしたい。そうすることで、英語コンテンツの内容を理解できる。

#### Acceptance Criteria
1. When ユーザーが英語文字起こしを選択した場合、the システムは 音声を英語テキストに変換すること
2. While 文字起こし処理中の場合、the システムは 進行状況と推定残り時間を表示すること
3. The システムは 話者の区別、句読点、段落分けを適切に行うこと
4. When 文字起こしが完了した場合、the システムは テキスト結果を画面に表示し、LLM校正オプションを提供すること
5. If 音声が英語でない場合、then the システムは 言語不一致の警告を表示すること

### Requirement 5: 文字起こし結果の管理
**Objective:** ユーザーとして、生成された文字起こし結果をダウンロードまたはコピーできるようにしたい。そうすることで、結果を他のツールやドキュメントで利用できる。

#### Acceptance Criteria
1. When 文字起こしが完了した場合、the システムは 結果をテキストファイルとしてダウンロードするオプションを提供すること
2. When ユーザーがコピーボタンをクリックした場合、the システムは 文字起こしテキストをクリップボードにコピーすること
3. The システムは 複数のエクスポート形式（TXT、SRT、VTT）をサポートすること
4. When ユーザーがエクスポート形式を選択した場合、the システムは 選択された形式で適切にフォーマットされたファイルを生成すること
5. When 音声が分割処理された場合、then the システムは SRT/VTTのタイムスタンプがチャンク境界で不連続にならないように、最終出力で連続したタイムスタンプを生成すること

### Requirement 6: ユーザーインターフェース
**Objective:** ユーザーとして、直感的で使いやすいWebインターフェースを利用できるようにしたい。そうすることで、技術的な知識がなくても簡単に文字起こしを実行できる。

#### Acceptance Criteria
1. The システムは レスポンシブデザインで、デスクトップとモバイルデバイスの両方で適切に表示されること
2. While 処理が実行中の場合、the システムは ユーザーが現在のステータスを理解できる明確なフィードバックを提供すること
3. The システムは 各機能に対して明確なラベルとヘルプテキストを表示すること
4. When エラーが発生した場合、the システムは ユーザーフレンドリーなエラーメッセージと推奨される対処法を表示すること
5. While ジョブ処理中の場合、the システムは 少なくとも「download/extract → preprocess → transcribe（per chunk）→ merge → export」のステージを区別して表示できること

### Requirement 7: 文字起こし結果のLLM校正
**Objective:** ユーザーとして、文字起こし結果をLLMで校正できるようにしたい。そうすることで、変換エラーを修正し、適切な文章として読みやすいテキストを取得できる。

#### Acceptance Criteria
1. When 文字起こしが完了した場合、the システムは LLM校正オプションを表示すること
2. When ユーザーが校正ボタンをクリックした場合、the システムは 文字起こしテキスト全体をLLMに送信すること
3. The システムは LLMに対して以下の校正指示を与えること: 誤変換の修正、適切な句読点の配置、段落の整形、文法の修正
4. While LLM校正処理中の場合、the システムは 進行状況インジケーターを表示すること
5. When LLM校正が完了した場合、the システムは 元のテキストと校正後のテキストを並べて表示すること
6. The システムは ユーザーが元のテキストと校正後のテキストを切り替えて確認できるビューを提供すること
7. When ユーザーが校正結果を採用した場合、the システムは 校正後のテキストを最終結果として保存すること
8. If LLM校正に失敗した場合、then the システムは エラーメッセージを表示し、元の文字起こし結果を保持すること

### Requirement 8: パフォーマンスと制限
**Objective:** システムとして、適切なパフォーマンスとリソース管理を提供したい。そうすることで、安定した動作とサービス品質を保証できる。

#### Acceptance Criteria
1. The システムは 最大60分までの動画の処理をサポートすること
2. When 動画の長さが制限を超える場合、the システムは 処理前に警告を表示すること
3. The システムは 同時に複数の文字起こしリクエストを処理できること
4. While 高負荷時の場合、the システムは リクエストをキューに入れ、予想待ち時間をユーザーに通知すること

### Requirement 9: 大容量音声ファイル対応（自動圧縮/分割）
**Objective:** システムとして、OpenAIのアップロード制限（最大25MB）を超える音声でも自動的に処理できるようにしたい。そうすることで、ユーザーはYouTube URLを入力するだけで長い動画でも文字起こしを取得できる。

#### Acceptance Criteria
1. When 抽出された音声ファイルサイズがMAX_UPLOAD_MB以下の場合、the システムは そのまま（単一ファイルで）文字起こしを実行すること
2. If 抽出された音声ファイルサイズがMAX_UPLOAD_MBを超える場合、then the システムは 自動的に圧縮および/または分割を行い、アップロードされる各チャンクがTARGET_UPLOAD_MB未満になることを保証すること
3. The システムは 安全マージンを使用し、TARGET_UPLOAD_MBのデフォルト値を24MBとすること（設定で変更可能）
4. The システムは 音声前処理で音声認識に適した設定（例: モノラル、16kHzまたは24kHz、安定したコーデック（mp3またはopus）、音声向けの合理的なビットレート（32–64 kbps））を優先すること
5. When 音声を分割する場合、the システムは 単語の切断を避けるためにチャンク間にオーバーラップ・パディング（0.5–1.0秒）を付与すること（設定で変更可能）
6. When 文字起こしをチャンクごとに実行する場合、the システムは どのチャンクが失敗したかと理由をエラーとして報告すること
7. The システムは 最終テキストの結合時にオーバーラップ部分を考慮した基本的な重複除去を行うこと（完全な話者同定や高度な整合は非ゴールとして制限を明記すること）

### Requirement 10: 互換性・設定・ログ/テスト
**Objective:** システムとして、既存のAPI/UXを維持しつつ、設定可能性と運用上の観測性・品質保証を強化したい。そうすることで、環境差や長尺動画でも安定して運用できる。

#### Acceptance Criteria
1. The システムは 既存のAPIとUXを維持すること（ユーザー入力はYouTube URLのまま、出力フォーマットはTXT/SRT/VTTのまま）
2. The システムは Windows + WSL2 + Linuxで動作すること
3. The システムは 設定キーとしてMAX_UPLOAD_MB（デフォルト25）、TARGET_UPLOAD_MB（デフォルト24）、CHUNK_OVERLAP_SEC（デフォルト0.8）、任意でAUDIO_BITRATE_KBPSを提供すること
4. The システムは 構造化ログにて、入力サイズ、選択戦略（圧縮/分割）、チャンク数、各チャンクサイズ、チャンク別ステータスを記録すること
5. The システムは チャンク計画（chunk planning）と、タイムスタンプのオフセット適用と結合（SRT/VTT）についてユニットテストを提供すること（OpenAI呼び出しはモックすること）
